/*! ONF-NFB-html5-menu - v1.2.1 - 2014-05-06
* https://github.com/DeuxHuitHuit/ONF-NFB-html5-menu
* Copyright (c) 2014 Deux Huit Huit, ONF/NFB; Licensed MIT */
(function(e,t){"use strict";window.console||(window.console={},window.console.log=window.console.warn=window.console.error=window.console.info=e.noop),Array.prototype.forEach||(Array.prototype.forEach=function(e){var t=this.length,n=0,r=arguments[1];if(typeof e!="function")throw new TypeError("First parameter must be a function");for(n=0;n<t;n++)n in this&&e.call(r,this[n],n,this)});var n=768,r=55,i="onf-nfb",s="topclick.onf-nfb",o="help.onf-nfb",u="lang.onf-nfb",a="search.onf-nfb",f="botclick.onf-nfb",l="share.onf-nfb",c="volume.onf-nfb",h="fullscreen.onf-nfb",p=[],d={target:"#onf-top",opacity:.8,opacityHover:1,recursive:!1,ready:null,links:[{title:{fr:"Explorer",en:"Explore"},url:{fr:"http://www.onf.ca/explorer-tous-les-films/",en:"http://www.nfb.ca/explore-all-films/"},callback:null,preventDefault:!1,target:null,cssClass:null,tag:"explore"},{title:{fr:"Sélections",en:"Playlists"},url:{fr:"http://onf.ca/selections/",en:"http://www.nfb.ca/playlists/"},callback:null,preventDefault:!1,target:null,cssClass:null,tag:"playlist"},{title:{fr:"Chaînes",en:"Channels"},url:{fr:"http://www.onf.ca/chaines/",en:"http://www.nfb.ca/channels/"},callback:null,preventDefault:!1,target:null,cssClass:null,tag:"channels"},{title:{fr:"Blogue",en:"Blog"},url:{fr:"http://blogue.onf.ca/",en:"http://blog.nfb.ca/"},callback:null,preventDefault:!1,target:null,cssClass:null,tag:"blog"},{title:{fr:"Interactif",en:"Interactive"},url:{fr:"http://www.onf.ca/interactif/",en:"http://www.nfb.ca/interactive/"},callback:null,preventDefault:!1,target:null,cssClass:"active",tag:"interative"}],search:{title:{fr:"Recherche",en:"Search"},callback:null},help:{title:{fr:"Aide",en:"Help"},url:{fr:"http://www.onf.ca/a-propos/faq/",en:"http://www.nfb.ca/about/faq/"},callback:null,preventDefault:!1,target:"_blank",cssClass:null,tag:"help"},translate:[{title:"Français",url:"http://interactif.onf.ca/",callback:null,preventDefault:!1,target:null,cssClass:null,tag:"lang-fr"},{title:"English",url:"http://interactive.nfb.ca/",callback:null,preventDefault:!1,target:null,cssClass:null,tag:"lang-en"}]},v={target:"#onf-bot",opacity:.8,opacityHover:1,recursive:!1,ready:null,links:[{title:{fr:"Accueil",en:"Home"},url:"/index/",callback:null,preventDefault:!0,target:null,cssClass:"onf-bot-cont onf-bot-border",tag:"home"},{title:{fr:"À propos",en:"About"},url:{fr:"/a-propos/",en:"/about/"},callback:null,preventDefault:!0,target:null,cssClass:"onf-bot-cont onf-bot-border",tag:"about"},{title:{fr:"Films reliés",en:"Related movies"},url:{fr:"/relies/",en:"/related/"},callback:null,preventDefault:!0,target:null,cssClass:"onf-bot-cont onf-bot-border",tag:"related"},{title:{fr:"Équipe",en:"Credits"},url:{fr:"/equipe/",en:"/credits/"},callback:null,preventDefault:!0,target:null,cssClass:"onf-bot-cont",tag:"credits"}],share:{title:{fr:"Partagez",en:"Share"},links:{facebook:"http://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(document.location),twitter:"https://twitter.com/intent/tweet?text="+encodeURIComponent(document.title)+"&url="+encodeURIComponent(document.location),stumpleupon:"http://www.stumbleupon.com/submit?url="+encodeURIComponent(document.location)+"&title="+encodeURIComponent(document.title),digg:"http://digg.com/submit?phase=2&url="+encodeURIComponent(document.location)+"&bodytext="+encodeURIComponent(document.title),delicious:"http://www.delicious.com/post?v=2&url="+encodeURIComponent(document.location)+"&title="+encodeURIComponent(document.title)},callback:null},volume:{title:{fr:"Volume",en:"Volume"},callback:null},fullscreen:{title:{fr:"Plein écran",en:"Fullscreen"},callback:null}},m=!window.navigator||!navigator.userAgent?!1:navigator.userAgent,g=function(){var t={unsupported:!e.browser||!!(e.browser.msie&&parseInt(e.browser.version,10)<9),ipad:!!m&&!!m.match(/iPad/i),iphone:!!m&&!!m.match(/iPhone/i)||!!m.match(/iPod/i),android:!!m&&!!m.match(/Android/i)};return t.ios=t.ipad||t.iphone,t.mobile=t.ios||t.android||!!m&&(m.match(/mobile/i)||m.match(/phone/i))||!!document.location.toString().match(/\.+(\?|#)mobile$/i),t}(),y=function(t){return e.isFunction(t)?t.call(this,E):t},b=function(t){return e.isPlainObject(t)?t[E]:y(t)},w=function(e,t){return e?e:t},E=w(e("html").attr("lang"),"en"),S=E==="fr"?"interactif":"interactive",x=E=="fr"?"https://www.onf.ca":"https://www.nfb.ca",T="https://www.nfb.ca/search?entqr=0&output=xml_no_dtd&sort=date%3AD%3AL%3Ad1&client=beta_onfb&ud=1&oe=UTF-8&ie=UTF-8&proxystylesheet=beta_onfb&proxyreload=1&hl="+E+"&lr=lang_"+E+"&site=beta_onfb&q=",N=function(e,t,n,r){var i=e+" > "+t;return!n||(i+=" > "+n),isNaN(r)||(i+=" > "+r),i},C=function(t){return!!t&&e.isFunction(t.preventDefault)&&t.preventDefault(),!1},k=function(t){var n=e(this),r=n.data("link"),i=n.data("event"),s=n.data("target"),o=r.tag||n.attr("data-tag"),u=s.data("opts"),a=!0;return!r||(e.isFunction(r.callback)&&r.callback.call(n,t,n,u,o),!r.preventDefault||(a=C(t))),s.triggerHandler(i,[t,n,u,o]),r.url?e.onf_nfb.stats.trackPageview(b(r.url)):e.onf_nfb.stats.trackEvent("menu","click",o,n.index()),a},L=function(t,n){var r=e(this),i=r.data("opts"),s=y(i.opacity);n&&(s=y(i.opacityHover)),r.stop(!0,!1).animate({opacity:s},250)},A=function(e){L.call(this,e,!0)},O=function(e){L.call(this,e,!1)},M=function(t,n,r){var i=e("<a></a>");return i.text(b(t.title)),t.url?i.attr("href",b(t.url)):i.attr("href","#"),i.data("link",t),i.data("target",n),i.data("event",r),!t.target||i.attr("target",y(t.target)),!t.cssClass||i.attr("class",b(t.cssClass)),i.click(k),i},_=function(){return document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||document.webkitFullScreen||document.msFullScreen},D=function(e){return _()?B(e):H(e)},P=function(){var e=document.documentElement,t=e.requestFullScreen||e.webkitRequestFullScreen||e.webkitEnterFullScreen||e.mozRequestFullScreen||e.msRequestFullScreen;return t},H=function(n){var r=P(),i=!1;return r!==t&&e.isFunction(r)&&(r.call(document.documentElement),i=!0),i&&(e.event.trigger(h,[n,this,!0]),e.onf_nfb.stats.trackEvent("menu","fullscreen",!0)),C(n)},B=function(n){var r=!1,i=document,s=i.exitFullScreen||i.cancelFullScreen||i.webkitExitFullScreen||i.webkitCancelFullScreen||i.mozExitFullScreen||i.mozCancelFullScreen||i.msExitFullScreen||i.msExitCancelScreen;return s!==t&&e.isFunction(s)&&(s.call(i),r=!0),r&&(e.event.trigger(h,[n,this,!1]),e.onf_nfb.stats.trackEvent("menu","fullscreen",!1)),C(n)},j=function(){return!!P()},F=function(t){var n=e("#onf-volume"),r=!1;return n.toggleClass("muted"),r=n.hasClass("muted"),!e.cookie||e.cookie("muted",r?1:null,{expires:7,path:"/"}),e.event.trigger(c,[t,n,r]),e.onf_nfb.stats.trackEvent("menu","mute",r),C(t)},I=function(t,n,r){e.isFunction(n)&&(!!r&&e.isFunction(r.on)?r.on(t,n):e(document).on(t,n))},q=function(t,n,r,i,s){console.warn('"stats.log" is deprecated and will be removed in 1.2. Please use "stats.trackEvent" instead.'),e.onf_nfb.stats.trackEvent(t,n,r,i,s)},R=function(e,t,n,r,i){var s=y(this.minDelay),o=function(){p.forEach(function(i,s){try{i.trackEvent(e,t,n,r)}catch(o){console.error("[stats.trackEvent] "+i.name+": "+o.message)}})};if(!i||isNaN(i)||i<s)i=s;setTimeout(o,i)},U=function(e,t){var n=y(this.minDelay),r=function(){p.forEach(function(t,n){try{t.trackPageview(e)}catch(r){console.error("[stats.trackPageview] "+t.name+": "+r.message)}})};if(!t||isNaN(t)||t<n)t=n;setTimeout(r,t)},z=function(t,n,r,i,s){var o=y(this.minDelay),u=n||e.onf_nfb.defaults.stats.actions[t]||e.onf_nfb.defaults.stats.actions["default"],a=function(){p.forEach(function(e,n){try{e.trackSocial(t,u,r,i)}catch(s){console.error("[stats.trackSocial] "+e.name+": "+s.message)}})};if(!s||isNaN(s)||s<o)s=o;setTimeout(a,s)},W=function(e,t){e.init(t),p.push(e)},X=function(t){e.each(e.onf_nfb.defaults.stats.loggers,function(){W(this,t),this.trackPageview(window.location.pathname)})},V=function(t){var n=e("#onf-top-search-txt").val();return!!n&&n.length>0&&(e.event.trigger(a,[t,this,n]),e.onf_nfb.stats.trackEvent("menu","search",n),setTimeout(function(){document.location=T+encodeURIComponent(n)},e.onf_nfb.stats.minDelay)),C(t)},$=function(t,n){var r=e("#onf-top-search-pnl"),i=e("#onf-top-search-lbl"),s=r.find("input[type=text]").eq(0);return r[n?"fadeIn":"fadeOut"].call(r,400),i[n?"fadeOut":"fadeIn"].call(i,400),s[n?"focus":"blur"].call(s),C(t)},J=function(e){return $.call(this,e,!0)},K=function(e){return $.call(this,e,!1)},Q=function(e){switch(e.which){case 27:K.call(this);break;case 13:V()}return!0},G=function(e,t){return function(n){e.animate({right:t+"px"},300)}},Y=function(t){var n=e.extend(!t||!t.recursive?{}:!0,n,d,t),r=e(n.target),i=Math.abs(y(n.opacity)-y(n.opacityHover))>0,f=e('<a id="onf-top-logo"></a>'),l=e('<span id="onf-top-search"></span>'),c=e('<a href="#" id="onf-top-search-lbl"></a>'),h=e('<div id="onf-top-search-pnl"></div>'),p=e('<input id="onf-top-search-txt" type="text" />'),v=e('<input id="onf-top-search-btn" type="button" value="" />'),m=e('<div id="onf-top-right"></span>'),g=e('<div id="onf-top-wrap"></div>'),w=e('<div id="onf-hamburger"></div>'),S=e('<div id="onf-mobile-wrap"><button></button></div>');if(!r||!r.length){console.error("[top] the target "+n.target+" could not be found.");return}f.attr("href",x),f.click(function(t){return e.event.trigger(s,[t,this,n,"logo"]),e.onf_nfb.stats.trackEvent("menu","click","logo"),!0}),g.append(f),!!n.links&&!!n.links.length&&n.links.forEach(function(e,t){g.append(M(e,r,s)),S.append(M(e,r,s))}),!n.search||(c.text(b(n.search.title)),c.click(J),p.attr("placeholder",b(n.search.title)),p.keydown(Q),v.click(V),h.append(p).append(v),l.append(c).append(h),g.append(l),e(document.documentElement).mousedown(function(e){return e.target.nodeName!="INPUT"&&K(e),!0}),S.append(M({url:T,title:b(n.search.title),target:"_blank"},null,a)),I(a,n.search.callback)),!n.help||(m.append(M(n.help,r,o)),n.help.cssClass||(n.help.cssClass=""),n.help.cssClass+=" onf-help",S.append(M(n.help,r,o))),!!n.translate&&!!n.translate.length&&n.translate.forEach(function(e,t){e.tag!="lang-"+E&&(m.append(M(e,r,u)),S.append(M(e,r,u)))}),g.append(m),g.append(w),r.empty().append(g),e("body").append(S),r.data("opts",n),i?(r.hover(A,O),O.call(r)):r.off("mouseenter",A).off("mouseleave",O),w.click(G(S,0)),S.find("button").click(G(S,-115)),e.isFunction(n.ready)&&n.ready.call(r,n)},Z=function(){return e(window).width()>n?r:0},et=function(t,n){var r=e("#onf-bot-share"),i=Z(),s=r.find(".onf-social").length,o=i+20*s;return n&&(i=o),r.stop(!1,!1).animate({width:i},o*2),C(t)},tt=function(e){return et.call(this,e,!0)},nt=function(e){return et.call(this,e,!1)},rt=function(t){var n=e.extend(!t||!t.recursive?{}:!0,n,v,t),r=e(n.target),i=Math.abs(y(n.opacity)-y(n.opacityHover))>0,s=e('<div id="onf-bot-wrap"></div>'),o=e('<span id="onf-bot-right"></span>'),u=e('<span id="onf-bot-share"></span>'),a=e('<span id="onf-share-opts"></span>'),p=e('<a href="#" id="onf-volume"></a>'),d=e('<a href="#" id="onf-fullscreen"></a>');if(!r||!r.length){console.error("[bot] the target "+n.target+" could not be found.");return}!!n.links&&!!n.links.length&&n.links.forEach(function(e,t){s.append(M(e,r,f))});if(!!n.share){u.append(e('<span id="onf-share-lbl">'+b(n.share.title)+"</span>"));var m=function(t){var n=e(this),r=n.data().index;return e.event.trigger(l,[t,this,r]),e.onf_nfb.stats.trackSocial(r),!0};e.each(n.share.links,function(n,r){var i=e("<a></a>").attr("href",y(r)).attr("data-tag",n).attr("id","onf-"+n).attr("class","onf-social").attr("target","_blank").data("index",n).click(m);a.append(i)}),u.mouseenter(tt),r.mouseleave(nt),u.append(a),o.append(u),I(l,n.share.callback,a)}!!n.volume&&!g.mobile&&(p.text(b(n.volume.title)),p.click(F),!!e.cookie&&!!e.cookie("muted")&&p.addClass("muted"),o.append(p),I(c,n.volume.callback,p)),!!n.fullscreen&&j()&&(d.text(b(n.fullscreen.title)),d.click(D),o.append(d),I(h,n.fullscreen.callback,d)),s.append(o),r.empty().append(s),r.data("opts",n),i?(r.hover(A,O),O.call(r)):r.off("mouseenter",A).off("mouseleave",O),e(window).resize(function(){u.width(Z())}),e.isFunction(n.ready)&&n.ready.call(r,n)};e.onf_nfb=e.extend(!0,e.onf_nfb,{stats:{minDelay:80,init:X,log:q,add:W,trackPageview:U,trackEvent:R,trackSocial:z},menu:{top:Y,bot:rt},defaults:{top:d,bot:v,stats:{loggers:{ntpt:{name:"Unica NetInsight",params:null,init:e.noop,trackEvent:function(t,n,r,i){if(!!window.ntptEventTag&&e.isFunction(ntptEventTag)){var s=N(t,n,r,i);return ntptEventTag("ln="+E+"&ev="+S+"&ntpgi_interactive_page="+s),!0}return!1},trackPageview:function(e){this.trackEvent("_link",e)},trackSocial:function(e,t,n,r){this.trackEvent(n,e,t)}},ga:{name:"Google Analytics",params:null,_addCustomVars:function(t){!!window._gaq&&e.isFunction(_gaq.push)&&(_gaq.push(["t2._setAccount","UA-32257069-1"]),_gaq.push(["_gat._anonymizeIp"]),_gaq.push(["t2._setAllowLinker",!0]),_gaq.push(["_setCustomVar",2,"ln",E,2]),_gaq.push(["t2._setCustomVar",2,"ln",E,2]),_gaq.push(["_setCustomVar",5,"ev",S,3]),_gaq.push(["t2._setCustomVar",5,"ev",S,3]),_gaq.push(["_setCustomVar",3,"Interactif",t.name,3]),_gaq.push(["t2._setCustomVar",3,"Interactif",t.name,3]))},init:function(e){this.params=e,this._addCustomVars(this.params)},trackEvent:function(n,r,i,s){return!!window._gaq&&e.isFunction(_gaq.push)?(i=i?i.toString():t,s=s?parseInt(s,10):t,_gaq.push(["_trackEvent",n,r,i,s]),_gaq.push(["t2._trackEvent",n,r,i,s]),!0):!1},trackPageview:function(t){if(!!window._gaq&&e.isFunction(_gaq.push)){var n="/"+S+"/"+this.params.name+"/"+t;return n=n.replace(/\/\//gi,"/"),_gaq.push(["_trackPageview",n]),_gaq.push(["t2._trackPageview",n]),!0}return!1},trackSocial:function(t,n,r,i){return!!window._gaq&&e.isFunction(_gaq.push)?(_gaq.push(["_trackSocial",t,n,r,i]),_gaq.push(["t2._trackSocial",t,n,r,i]),!0):!1}},comscore:{name:"Comscore",params:null,init:e.noop,trackEvent:function(t,n,r,i){if(!!window.COMSCORE&&e.isFunction(COMSCORE.beacon)){var s=N(t,n,r,i);COMSCORE.beacon({c1:"2",c2:"6035506",c4:S+"/"+s})}},trackPageview:function(t){!!window.COMSCORE&&e.isFunction(COMSCORE.beacon)&&COMSCORE.beacon({c1:"2",c2:"6035506",c4:S+"/"+t})},trackSocial:function(e,t,n,r){this.trackEvent(n,e,t)}}},actions:{"default":"share",facebook:"like",twitter:"tweet"}}},events:{namespace:i,topclick:s,help:o,lang:u,search:a,botclick:f,share:l,volume:c,fullscreen:h}})})(jQuery);